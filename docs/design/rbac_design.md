# RBAC Design: Role-Based Access Control Design

RBAC是每一个涉及到权限控制的系统都需要设计的部分。它提供了一种灵活的方式来管理用户权限，确保系统的安全性和可维护性。

在微信登录完成后，我们可以获取到OpenID和UnionID，我们需要根据用户的角色和权限来控制他们在系统中的操作。RBAC设计将帮助我们实现这一目标。

## 文档更新记录


| Code | Module | Date       | Author | PRI | Description |
|------|--------|------------|--------|-----|-------------|
| 1    | init   | 2025-06-25 | AEnjoy | P0  | 初始设计文档创建    |
| 2    | update | 2026-01-08 | Benins | P0  | 更新           |


## 设计原则

1. **高内聚低耦合**: RBAC模块与其他模块通过接口和事件解耦，确保模块独立性(可以独立测试和部署)
2. **安全性**: 确保用户权限的安全性，防止未授权访问
3. **精细度**: 支持细粒度的权限控制，允许对特定资源和操作进行精确授权
4. **易用性**: 提供简单易用的权限管理接口
5. **可扩展性**: 支持动态添加和修改角色和权限
6. **性能**: 确保权限检查的高效性，避免性能瓶颈，**建议将该部分存入缓存中**

## 用户类别

- **访客**: 未微信登录的用户，仅能访问公开接口
- **基本用户**: 微信登陆后默认授予的用户角色
- **活跃用户**: 系统根据活跃度计算规则自动升级，解锁部分权限
- **认证用户**: 主动完成校内身份认证的用户，解锁部分权限
- **运营**: 负责社区管理，拥有部分管理权限
- **管理**: 负责系统管理，拥有所有权限

## 模型

角色表: (Id (PK), RoleTag, Name, Description)

权限表: (Id (PK), PermissionTag, Name, Description)

用户角色关联 (UserRole): (UserId (FK), RoleId)

角色权限关联表 (RolePermission): (RoleId (FK), PermissionId (FK))

## 鉴权流程：

1. 用户登录后，检查直接权限，如果拥有所请求的权限，则直接允许访问。
   - 例如，用户1001请求删除数据，系统首先检查用户1001是否有DATA_DELETE权限。
   - 如果有，则直接允许访问。
   - 如果没有，则继续下一步。
2. 系统根据用户的UserID查询其关联的角色列表。
3. 根据角色列表查询每个角色的权限列表。
4. 将权限列表缓存到用户会话中。
5. 在每次请求时，系统检查用户的权限是否包含所请求的操作对应的权限。

详细设计见 Model/RBAC